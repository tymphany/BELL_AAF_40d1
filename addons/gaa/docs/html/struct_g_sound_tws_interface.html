<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GAA Addon: GSoundTwsInterface Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GAA Addon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('struct_g_sound_tws_interface.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">GSoundTwsInterface Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;services/voice_ui/gaa/gsound/gsound_target_tws.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a6e0f76c90629398d858a0bae6b8614c4"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#a6e0f76c90629398d858a0bae6b8614c4">gsound_tws_role_change_cancel</a> )(void)</td></tr>
<tr class="separator:a6e0f76c90629398d858a0bae6b8614c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62ff026dade65828d7a9164fc830dbca"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#a62ff026dade65828d7a9164fc830dbca">gsound_tws_role_change_fatal</a> )(bool to_master)</td></tr>
<tr class="separator:a62ff026dade65828d7a9164fc830dbca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6298719c9914b1afabdc4e70456a129"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#ae6298719c9914b1afabdc4e70456a129">gsound_tws_role_change_force</a> )(int32_t reconnection_delay)</td></tr>
<tr class="separator:ae6298719c9914b1afabdc4e70456a129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9ae349a0fe984e3c68cf06ac8e567f9"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#ae9ae349a0fe984e3c68cf06ac8e567f9">gsound_tws_role_change_init_role</a> )(bool is_master)</td></tr>
<tr class="separator:ae9ae349a0fe984e3c68cf06ac8e567f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e8dbaf0451703224c327e63e403666f"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#a0e8dbaf0451703224c327e63e403666f">gsound_tws_role_change_perform</a> )(int32_t reconnection_delay)</td></tr>
<tr class="separator:a0e8dbaf0451703224c327e63e403666f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a032a5f95ebc463a1164517a71fb2b341"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#a032a5f95ebc463a1164517a71fb2b341">gsound_tws_role_change_request</a> )(void)</td></tr>
<tr class="separator:a032a5f95ebc463a1164517a71fb2b341"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2f58d389c07434b0f0a49d8699d3b44"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_g_sound_tws_interface.html#af2f58d389c07434b0f0a49d8699d3b44">gsound_tws_role_change_target_done</a> )(bool to_master)</td></tr>
<tr class="separator:af2f58d389c07434b0f0a49d8699d3b44"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This header file was generated by Google GSound Services, it should not be altered in any way. Please treat this as a read-only file.</p>
<p>Each function listed below must be implemented for each specific platform / SDK </p><h1>TWS (True Wireless) Description</h1>
<h2>Initialization</h2>
<p>Initially, GSoundTargetTwsInit is called by GSound. The target must sometime call gsound_tws_role_change_init_role on both the master and the slave to set which device is the master and slave. Until gsound_tws_role_change_init_role is executed, GSound will do nothing.</p>
<h2>Controlled switch</h2>
<p>A "controlled" switch is a switch while the master and slave can still communicate.</p>
<h3>Controlled switch on master</h3>
<p>For the master to role change to slave:</p><ol type="1">
<li>Call gsound_tws_role_change_request on the master.</li>
<li>Some time later, GSound will call GSoundTargetTwsRoleChangeResponse<ul>
<li>if rejected, then it is undesirable to do a role change at this time (e.g. voice query ongoing or expected soon). No change in state. Target should start over from step 1 and call gsound_tws_role_change_request at a later time.</li>
<li>if accepted, then target is free to perform a role change. Note that GSound will not accept voice queries until the role change is complete.</li>
</ul>
</li>
<li>Call gsound_tws_role_change_perform after GSound responds with GSoundTargetTwsRoleChangeResponse(accepted) to allow the role change to proceed.</li>
<li>If the target needs to do a role switch now and cannot wait for GSound to accept a request, it can instead call gsound_tws_role_change_force.</li>
<li>After the target calls gsound_tws_role_change_perform or gsound_tws_role_change_force, GSound will some time later call the target's implementation of GSoundTargetTwsRoleChangeGSoundDone. The target may then finish its own role change.</li>
<li>After the target does the role change, it calls gsound_tws_role_change_target_done on the new master and new slave.</li>
</ol>
<p>[start, device is master] &lt;--------------------------&mdash;T | | | | v | [ target call ] | [gsound_tws_role_change_request] ^ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">[ optional target call ]   </td></tr>
</table>
<p>+&ndash;[gsound_tws_role_change_cancel]&mdash;&gt;-----&mdash;+ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td></tr>
</table>
<p>[GSound will call target's definition] | [of GSoundTargetTwsRoleChangeResponse] ^ | | +-(reject)-&gt;&mdash;&gt;[target tries again later]-&gt;&ndash;+ | | (accept) ^ </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">[ optional target call ]   </td></tr>
</table>
<p>+&ndash;[gsound_tws_role_change_cancel]-&mdash;&gt;----&mdash;┘ | | | | v | [ target call ] | [gsound_tws_role_change_perform] | | | | | | ^ [ GSound will call target's definition ] | [of GSoundTargetTwsRoleChangeGSoundDone] | | | v | | [ optional target call ] | +&ndash;[gsound_tws_role_change_cancel]-&mdash;&gt;----&mdash;┘ | v [ target call ] [gsound_tws_role_change_target_done] | | v [Role change complete, this] [ device is now a slave ]</p>
<h3>Controlled switch on slave</h3>
<p>For the slave to role change to master:</p><ol type="1">
<li>Call gsound_tws_role_change_target_done with to_master set to true. No prior request is required on the slave.</li>
</ol>
<p>[start, device is slave] | | v [ target call ] [gsound_tws_role_change_target_done] | | v [role change complete, this] [device is now a master ]</p>
<h1>Uncontrolled switch</h1>
<p>An "uncontrolled" switch is where the devices abruptly lose communication with each other. An uncontrolled role change is likely to cause some loss of assistant functionality for up to a couple minutes and should be avoided if at all possible. For an uncontrolled switch:</p><ol type="1">
<li>call gsound_tws_role_change_fatal </li>
</ol>
</div><h2 class="groupheader">Field Documentation</h2>
<a id="a6e0f76c90629398d858a0bae6b8614c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e0f76c90629398d858a0bae6b8614c4">&#9670;&nbsp;</a></span>gsound_tws_role_change_cancel</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_cancel) (void)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which may be executed by the target on the master. It may be called any time after a gsound_tws_role_change_request or force and prior to a gsound_tws_role_change_target_done. </p>

</div>
</div>
<a id="a62ff026dade65828d7a9164fc830dbca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62ff026dade65828d7a9164fc830dbca">&#9670;&nbsp;</a></span>gsound_tws_role_change_fatal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_fatal) (bool to_master)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on the master or slave to cause an immediate transition in GSound to the given role. This shall only be called in catastrophic (fatal - uncontrolled) cases. When at all possible, use the other callbacks for more orderly role change transitions.</p>
<p>param[in]: to_master true if the new role is to be master, false if the new role is to be slave </p>

</div>
</div>
<a id="ae6298719c9914b1afabdc4e70456a129"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6298719c9914b1afabdc4e70456a129">&#9670;&nbsp;</a></span>gsound_tws_role_change_force</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_force) (int32_t reconnection_delay)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on the master (without any prior request) if an immediate role change is needed. GSound will respond some time later with GSoundTargetTwsRoleChangeGSoundDone. For backwards compatibility with older companion app versions, if GSound does not respond with GSoundTargetTwsRoleChangeGSoundDone within 500 msec, the target must use the gsound_tws_role_change_fatal callback.</p>
<p>param[in]: reconnection_delay - set the length of time in milliseconds that the companion app is required to leave the rfcomm channel disconnected before attempting to reconnect. </p>

</div>
</div>
<a id="ae9ae349a0fe984e3c68cf06ac8e567f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9ae349a0fe984e3c68cf06ac8e567f9">&#9670;&nbsp;</a></span>gsound_tws_role_change_init_role</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_init_role) (bool is_master)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on boot to indicate which device is the master and which is the slave. Until this function is called, GSound will not function.</p>
<p>Only valid to call once.</p>
<p>param[in]: is_master true for master, false for slave </p>

</div>
</div>
<a id="a0e8dbaf0451703224c327e63e403666f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e8dbaf0451703224c327e63e403666f">&#9670;&nbsp;</a></span>gsound_tws_role_change_perform</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_perform) (int32_t reconnection_delay)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on the master. GSound will respond with GSoundTargetTwsRoleChangeGSoundDone. It should be called sometime after GSound calls GSoundTargetTwsRoleChangeResponse(accepted). For backwards compatibility with older companion app versions, if GSound does not respond with GSoundTargetTwsRoleChangeGSoundDone within 500 msec, the target must use the gsound_tws_role_change_fatal callback.</p>
<p>param[in]: reconnection_delay - set the length of time in milliseconds that the companion app is required to leave the rfcomm channel disconnected before attempting to reconnect. </p>

</div>
</div>
<a id="a032a5f95ebc463a1164517a71fb2b341"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a032a5f95ebc463a1164517a71fb2b341">&#9670;&nbsp;</a></span>gsound_tws_role_change_request</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_request) (void)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on the master to request if it is an appropriate time to do a role change (e.g. no voice query/response ongoing). Response will occur asynchronously: later GSound will call GSoundTargetTwsRoleChangeResponse with accept or reject. </p>

</div>
</div>
<a id="af2f58d389c07434b0f0a49d8699d3b44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2f58d389c07434b0f0a49d8699d3b44">&#9670;&nbsp;</a></span>gsound_tws_role_change_target_done</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* gsound_tws_role_change_target_done) (bool to_master)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback which should be executed by the target on both the master and the slave. On the master, the target must wait for GSoundTargetTwsRoleChangeGSoundDone before sending gsound_tws_role_change_target_done.</p>
<p>On the (old) <em>master</em>:</p><ul>
<li>After the target's role change is actually completed. Target is now the slave. On the (old) <em>slave</em>:</li>
<li>After the target's role change is actually completed. Target is now the master.</li>
</ul>
<p>param[in]: to_master true if role is expected to be a master now, false if role should be a slave. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_g_sound_tws_interface.html">GSoundTwsInterface</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
